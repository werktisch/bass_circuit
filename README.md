# Bass Circuit Simulator

Fender Jazz Bassのトーン回路（パッシブ回路）特性をシミュレートするPythonアプリケーションです。
ピックアップのインダクタンス、ボリューム・トーン回路の相互作用、ケーブル容量の影響などを物理モデルに基づいて計算し、リアルタイムに可視化します。

## 主な機能
*   **回路モデル:** ジャズベース特有の「2ボリューム・1トーン」構成を再現。
    *   **Independent Volume Wiring:** 各ボリュームが独立して機能する「逆配線（インディペンデント配線）」を採用。
*   **リアルタイム操作:** パラメータ変更（抵抗値、コンデンサ容量、ケーブル長など）が即座にグラフに反映されます。
*   **詳細な可視化:**
    *   **周波数特性:** レゾナンスピークと-3dB帯域幅を表示。
    *   **オシロスコープ:** 入力信号に対する波形変化（位相遅れ・減衰）を高解像度で表示。

## インストールと実行

必要なライブラリをインストール後、Panelサーバーを起動します。

```bash
pip install -r requirements.txt
panel serve app.py --show
```

## 数学的根拠 (Mathematical Basis)

本シミュレーターでは、回路網解析手法の一つである **ノード解析 (Nodal Analysis)** を用いています。これは SPICE 等の回路シミュレーターでも採用されている標準的な手法です。

### 1. 回路方程式
回路内の各ノード（接続点）におけるキルヒホッフの電流則 (KCL) を連立方程式として解きます。

$$ [Y] \cdot [V] = [I] $$

ここで、
*   $[Y]$: アドミタンス行列 ($N \times N$)。回路素子のコンダクタンス成分。
*   $[V]$: ノード電圧ベクトル ($N \times 1$)。求めたい未知数。
*   $[I]$: 電流源ベクトル ($N \times 1$)。ピックアップからの入力信号。

### 2. 素子のモデル化
各周波数 $f$ における角周波数 $\omega = 2\pi f$ を用いて、複素数領域で計算します。

*   **抵抗 (Resistor):**
    $$ Y_R = \frac{1}{R} $$
*   **キャパシタ (Capacitor):**
    $$ Y_C = j\omega C $$
*   **ピックアップ (Pickup):**
    内部抵抗 $R$ とインダクタンス $L$ の直列回路としてモデル化し、等価電流源を用います（ノートン等価変換）。
    $$ Z_{pu} = R + j\omega L $$
    $$ Y_{pu} = \frac{1}{Z_{pu}} $$

### 3. ポテンショメータ (Potentiometer)
ボリュームやトーンポットは、ツマミの位置 $\alpha (0 \le \alpha \le 1)$ に応じて分圧する2つの抵抗として扱います。
また、聴感上の変化を自然にするため、**Aカーブ（対数変化）** を近似式で再現しています。

$$ R_{total} = R_{up} + R_{down} $$
$$ R_{down}(\alpha) \approx R_{total} \cdot \alpha^k \quad (k \approx 4 \text{ for Audio Taper}) $$

### 4. インディペンデント配線 (Independent Wiring) topology
本シミュレーターでは、以下のトポロジーで行列を作っています。

*   **入力:** ボリュームポットのワイパー（センター端子）
*   **出力:** ボリュームポットの3番端子
*   **特徴:** ボリュームを0（ワイパーを接地）にしても、出力ライン（3番端子）はアースに落ちないため、もう片方のピックアップの信号は生き残ります。

このモデルにより、単なるフィルタ（ローパス）だけでなく、複数のピックアップやトーン回路が複雑に絡み合った実際のベースの挙動（相互干渉）を正確に再現しています。

### 履歴
2026-02-07: 初版、Antigravityで作成。内容の確かさは保証しませんし、確認もしていません。