# ベース回路シミュレーター 実装計画

## 目的
Fender Jazz Bassのトーン回路（パッシブ回路）の動作をWebブラウザ上でシミュレーションするアプリを作成します。
ピックアップ、ポット、キャパシタ、ケーブル、アース配線の抵抗などの値を変更し、**周波数特性（ボード線図）** と **出力波形（オシロスコープ）** の変化をリアルタイムに可視化します。

## ユーザー確認事項
> [!NOTE]
> **回路モデリング:** 「アース配線の抵抗」などの微細なニュアンスを正確に反映するため、SPICEのような **ノード解析 (Nodal Analysis)** の手法を用いて計算を行います。

## 変更内容

### プロジェクト構成
プロジェクトは `/Users/takeshi/Documents/Python_Scripts/bass_circuit/` 内に作成します。

#### [NEW] [circuit_model.py](file:///Users/takeshi/Documents/Python_Scripts/bass_circuit/circuit_model.py)
物理演算と回路計算を担当するモジュールです。
- **Class `BassCircuit`**:
    - `__init__(params)`: 各コンポーネントの初期値を設定。
    - `calculate_response(frequencies)`: 指定された周波数配列に対する電圧比（複素数）を計算。
    - `solve_circuit(freq)`: 各周波数ごとのアドミタンス行列を解く内部メソッド。
    - **計算戦略**:
        - 各素子をインピーダンス $Z = R + jX$ として扱います。
        - ユーザーが指定した抵抗値（ポットの回転角に応じたAカーブ計算含む）を反映し、連立方程式 $[Y][V] = [I]$ を解きます。

#### [NEW] [app.py](file:///Users/takeshi/Documents/Python_Scripts/bass_circuit/app.py)
Panelアプリケーションのメインファイルです。
- **UIレイアウト**:
    - **ヘッダー**: タイトルと簡易説明。
    - **サイドバー**: コンポーネントごとの操作パネル（ピックアップ、ボリューム、トーン、ケーブル/アンプ）。
    - **メインエリア**:
        - タブ1: **周波数特性** (Log-Logスケール)。ピークやロールオフを確認。
        - タブ2: **オシロスコープ** (時間領域)。入力正弦波に対する出力波形の変化（振幅・位相）を表示。
- **インタラクション**:
    - スライダ操作時に `BassCircuit` の再計算をトリガーし、グラフを即座に更新します。

#### [NEW] [requirements.txt](file:///Users/takeshi/Documents/Python_Scripts/bass_circuit/requirements.txt)
依存ライブラリ: `panel`, `bokeh`, `numpy`, `scipy`.

## 検証計画

### 自動テスト
計算ロジックの正当性を保証するため、テストスクリプト `test_circuit.py` を作成します。
- **ケース1: 直結 (スルー)** -> 入出力が等しい (0dB) こと。
- **ケース2: RCローパスフィルタ** -> 計算上のカットオフ周波数で -3dB になること。
- **ケース3: 2PU干渉** -> 片方のボリュームを0に絞った際、もう片方の音量が（回路定数依存で）若干変化する、あるいは完全にOffになる（結線方式によるが今回は標準的なJB配線＝独立ボリューム操作可能とする）挙動を確認。

### 手動検証
1.  `panel serve app.py --show` でアプリを起動。
2.  **周波数特性の確認:**
    - フロントのみ(Vol1=10, Vol2=0)、リアのみ(Vol1=0, Vol2=10)、ミックス(Vol1=10, Vol2=10) での特性差を確認（通常ミックス時はインピーダンスが下がり、高域が少し伸びる等の変化がある）。
    - トーンを絞った際の変化。
    - ケーブル容量を増やした際に、共振ピーク（レゾナンス）が低域側に移動するか。
    - ボリュームを絞った際に全帯域が減衰し、かつ高域の劣化（ハイ落ち）が見られるか。
3.  **波形の確認:**
    - 1kHzなどの固定周波数で、ボリューム/トーン操作に合わせて波形の振幅・位相が変化するか。
